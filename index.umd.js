!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["react","react-dom"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).React,e.ReactDOM)}(this,function(e,r){"use strict";function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var o,n,a={exports:{}},s={};var i,c=(n||(n=1,a.exports=function(){if(o)return s;o=1;var r=e,t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,i=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function d(e,r,o){var n,s={},d=null,l=null;for(n in void 0!==o&&(d=""+o),void 0!==r.key&&(d=""+r.key),void 0!==r.ref&&(l=r.ref),r)a.call(r,n)&&!c.hasOwnProperty(n)&&(s[n]=r[n]);if(e&&e.defaultProps)for(n in r=e.defaultProps)void 0===s[n]&&(s[n]=r[n]);return{$$typeof:t,type:e,key:d,ref:l,props:s,_owner:i.current}}return s.Fragment=n,s.jsx=d,s.jsxs=d,s}()),a.exports),d={};const l=t(function(){if(i)return d;i=1;var e=r;return d.createRoot=e.createRoot,d.hydrateRoot=e.hydrateRoot,d}()),p=[{role:"character",content:"¡Qué quieres, forastero! No tengo tiempo para tus tonterías."}];function u(){const[r,t]=e.useState(p),[o,n]=e.useState(""),[a,s]=e.useState(!1),i=e.useRef(null);e.useEffect(()=>{i.current?.scrollIntoView({behavior:"smooth"})},[r]);return c.jsxs("div",{style:f.chatContainer,children:[c.jsxs("div",{style:f.messagesContainer,children:[r.map((e,r)=>c.jsxs("div",{style:"user"===e.role?f.userMessage:f.characterMessage,children:[c.jsxs("strong",{children:["user"===e.role?"Tú:":"Drok:"," "]})," ",e.content]},r)),c.jsx("div",{ref:i})]}),c.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!o.trim()||a)return;const i={role:"user",content:o.trim()};t(e=>[...e,i]),n(""),s(!0);try{const e={systemInstruction:"Eres Drok, un enano gruñón de la facción Hacha de Piedra. Responde siempre de manera concisa y desconfiada.",conversationHistory:[...r,i]},o=await fetch("https://cors-anywhere.herokuapp.com/https://script.google.com/macros/s/AKfycbyaIm0GQL0am6B0PjR8T_JPUtr_7nQQtDGaCwUZZjUp4hd0PAGyytz2JBClqyzNAH86nQ/exec",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await o.text();if(!o.ok)throw new Error(`Error en el backend (${o.status}): ${n||o.statusText}`);const a={role:"character",content:(n?JSON.parse(n):{}).text||"Lo siento, tuve problemas para contactar a mi clan."};t(e=>[...e,a])}catch(c){console.error("Error al obtener respuesta de Gemini:",c);const e={role:"system",content:`Error: ${c instanceof Error?c.message:String(c)}`};t(r=>[...r,e])}finally{s(!1)}},style:f.inputForm,children:[c.jsx("input",{type:"text",value:o,onChange:e=>n(e.target.value),placeholder:a?"El enano está pensando...":"Pregúntale algo al enano...",disabled:a,style:f.inputField}),c.jsx("button",{type:"submit",disabled:a,style:f.sendButton,children:a?"⏳":"Enviar"})]})]})}const f={chatContainer:{maxWidth:"500px",margin:"20px auto",border:"1px solid #ccc",borderRadius:"8px",boxShadow:"0 2px 5px rgba(0,0,0,0.1)",backgroundColor:"#fff",height:"400px",display:"flex",flexDirection:"column"},messagesContainer:{padding:"10px",overflowY:"auto",flexGrow:1,borderBottom:"1px solid #eee"},userMessage:{textAlign:"right",backgroundColor:"#e6f7ff",padding:"8px",borderRadius:"5px",marginBottom:"5px"},characterMessage:{textAlign:"left",backgroundColor:"#f5f5f5",padding:"8px",borderRadius:"5px",marginBottom:"5px"},inputForm:{display:"flex",padding:"10px",borderTop:"1px solid #eee"},inputField:{flexGrow:1,padding:"10px",border:"1px solid #ccc",borderRadius:"5px",marginRight:"10px"},sendButton:{padding:"10px 15px",border:"none",borderRadius:"5px",backgroundColor:"#007bff",color:"white",cursor:"pointer"}};window.ReactCharacterChat={render:(e,r)=>{l.createRoot(r).render(c.jsx(u,{...e}))}}});
